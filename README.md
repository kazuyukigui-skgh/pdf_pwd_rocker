# PDF Locker

PDFファイルにパスワード保護を追加するローカルツールです。

[![License](https://img.shields.io/badge/License-Elastic_2.0-blue.svg)](LICENSE)
[![Commercial Use](https://img.shields.io/badge/Commercial-License_Required-orange.svg)](LICENSE)

**⚠️ 重要：商用利用には有料ライセンスが必要です**
- ✅ 個人・教育・非営利：無料
- 💼 病院・企業・政府機関：商用ライセンス必要（¥50,000〜/年）

詳細は[ライセンスセクション](#ライセンス)をご確認ください。

## 🎯 70代の方でも使える、シンプル版にアップデート！

このツールは**シニア世代の方でも安心して使える**ように設計されています。

### 🆕 NEW! Office文書も直接対応

**Word、Excel、PowerPointファイルも直接投げ込めます！**

- 📝 Word文書 (.docx)
- 📊 Excel表 (.xlsx)
- 📽️ PowerPoint資料 (.pptx)
- 📄 PDFファイル (.pdf)

→ すべて自動的にPDFに変換して鍵をかけます

### 主な改善点

- ✅ **3ステップのウィザード形式**：何をすればいいか迷わない
- ✅ **大きなボタンと文字**：読みやすく、押しやすい（16pt～24pt）
- ✅ **保存先は自動**：デスクトップの「パスワード付きPDF」フォルダに自動保存
- ✅ **パスワード表示機能**：確認入力不要、チェックを入れれば見える
- ✅ **優しい日本語**：専門用語なし、分かりやすい言葉だけ
- ✅ **Office文書対応**：Word/Excel/PowerPointも直接処理可能
- ✅ **患者ID自動認識**：ファイル名から患者IDを自動抽出してパスワード生成
- ✅ **詳しい手引き書付き**：「使い方ガイド.md」を参照

## 特徴

- **AES-256暗号化**: 業界標準の強力な暗号化方式
- **完全ローカル**: ファイルを外部サーバーに送信しません
- **シンプルなGUI**: 3ステップで誰でも使える
- **Office文書対応**: Word/Excel/PowerPointを自動でPDF化
- **複数ファイル対応**: 一度に複数のファイルを処理可能
- **患者ID自動認識**: ファイル名から患者ID（7〜10桁）を自動抽出
- **パスワード自動生成**: 患者ID+生年月日で安全なパスワードを自動生成
- **5つのパスワードパターン**: セキュリティレベルに応じて選択可能
- **exe化対応**: Pythonがないパソコンでも実行可能

## パスワードパターン

ファイル名から患者IDを自動認識し、5つのパターンから選択してパスワードを生成できます：

| パターン | 例 | セキュリティ | 推奨用途 |
|---------|-----|------------|---------|
| **パターン1: 患者ID + 月日** | 12345678-0101 | ★★★★☆ | **推奨** 院内・対外送付 |
| **パターン2: 患者ID + 年月日** | 12345678-19800101 | ★★★★★ | 最も安全、重要書類 |
| **パターン3: 患者IDのみ** | 12345678 | ★☆☆☆☆ | 院内限定、一時ファイル |
| **パターン4: 生年月日のみ** | 19800101 | ★★☆☆☆ | 患者本人が開く場合 |
| **パターン5: 自分で決める** | 任意 | ★★★☆☆〜 | 患者ID未検出時 |

### 患者ID自動認識

ファイル名から7〜10桁の数字を患者IDとして自動認識します。

**認識される例：**
- `12345678_山田太郎_CT.pdf` → 患者ID: **12345678**
- `CT_12345678_20260110.pdf` → 患者ID: **12345678**
- `[12345678]山田太郎.pdf` → 患者ID: **12345678**

### セキュリティ警告

パターン3（患者IDのみ）およびパターン4（生年月日のみ）を選択した場合、セキュリティ警告が表示されます。これらのパターンは安全性が低いため、院内限定または一時的な利用に限定してください。

## 必要環境

### 開発環境（ビルド用）
- Python 3.8以上
- pypdf[crypto]
- pyinstaller

### 実行環境
- **exe版**: Windows 10/11（Python不要）
- **app版**: macOS 10.14以上（Python不要）

## セットアップ

### 1. 開発環境の準備

```bash
# リポジトリをクローン（または展開）
cd pdf_pwd_rocker

# 仮想環境を作成（推奨）
python -m venv venv

# 仮想環境を有効化
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 依存パッケージをインストール
pip install -r requirements.txt
```

### 2. 動作確認

```bash
# Pythonから直接実行
python pdf_locker.py
```

### 3. exe/appファイルの生成

```bash
# ビルドスクリプトを使用（推奨）
python build.py

# または、シンプルなコマンドで
python build.py --simple

# ビルド成果物のクリーンアップ
python build.py --clean
```

生成されたファイルは `dist/` ディレクトリに作成されます：
- Windows: `dist/PDF_Locker.exe`
- macOS: `dist/PDF_Locker.app`

## 使い方

1. **PDF Lockerを起動**
   - exe版: `PDF_Locker.exe` をダブルクリック
   - Python版: `python pdf_locker.py`

2. **PDFファイルを選択**
   - 「ファイルを選択」ボタンをクリック
   - 複数ファイルの選択も可能

3. **パスワードを設定**
   - 「パスワードを設定」ボタンをクリック
   - パスワードを入力（確認のため2回入力）

4. **保存先を選択**
   - 保存先フォルダを選択（キャンセルで元のフォルダに保存）
   - ファイル名は `locked_元のファイル名.pdf` として保存

## 配布方法

1. `dist/PDF_Locker.exe` をUSBメモリやネットワーク共有でコピー
2. 配布先のPCでダブルクリックして実行

## 注意事項

### ウイルス対策ソフトの誤検知

PyInstallerで作成したexeファイルは、デジタル署名がないため、セキュリティソフトが「不明なファイル」として警告する場合があります。

**対策:**
- IT部門に事前に相談し、除外設定を依頼
- デジタル署名の取得を検討（商用展開の場合）

### ファイルサイズ

exeファイルには、Pythonランタイムとライブラリが含まれるため、20〜40MB程度のサイズになります。

### 起動時間

初回起動時は内部ファイルの展開のため、数秒〜十数秒かかる場合があります。

## 技術仕様

| 項目 | 内容 |
|------|------|
| 暗号化方式 | AES-256 |
| PDFライブラリ | pypdf |
| GUIフレームワーク | tkinter（Python標準） |
| パッケージング | PyInstaller |

## トラブルシューティング

### 「cryptography」関連のエラー

AES-256暗号化には `cryptography` ライブラリが必要です：

```bash
pip install pypdf[crypto]
```

### exeが起動しない

1. ウイルス対策ソフトの除外設定を確認
2. 管理者として実行を試す
3. 別のフォルダにコピーして実行

### パスワード設定済みPDFを処理できない

既にパスワードが設定されているPDFは処理できません。
先にパスワードを解除してから再度お試しください。

## ライセンス

**Elastic License 2.0**

このソフトウェアはElastic License 2.0の下で提供されます。

### 📖 利用条件

#### ✅ 無料で利用できる場合
- 個人的な非商用利用
- 教育機関での教育目的の利用
- 非営利団体での非営利活動における利用

#### 💼 商用ライセンスが必要な場合
- 病院、クリニック等の医療機関での業務利用
- 企業での業務利用
- 政府機関での利用
- その他、営利目的での利用

### 💰 商用ライセンス価格（参考）

| 規模 | 年間ライセンス費用 |
|------|-------------------|
| 小規模（1〜50ユーザー） | ¥50,000/年 |
| 中規模（51〜200ユーザー） | ¥150,000/年 |
| 大規模（201ユーザー〜） | ¥300,000/年 |

**含まれるサービス：**
- ソフトウェアの商用利用権
- 年間サポート（メール対応）
- アップデート提供

**オプション：**
- 導入支援サービス：¥100,000〜
- カスタマイズ対応：別途見積もり

### 📧 お問い合わせ

商用ライセンスに関するお問い合わせは、GitHub Issuesまたはリポジトリのメール欄よりご連絡ください。

### 🔍 ソースコードの透明性

ソースコードは公開されており、自由に閲覧・監査できます。病院や企業のIT部門による
セキュリティ監査にも対応可能です。

## 更新履歴

- v1.0.0 - 初回リリース
  - 基本的なPDFパスワード設定機能
  - 複数ファイル対応
  - AES-256暗号化
